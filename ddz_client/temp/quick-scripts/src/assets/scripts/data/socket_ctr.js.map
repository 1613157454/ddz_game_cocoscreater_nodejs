{"version":3,"sources":["assets/scripts/data/socket_ctr.js"],"names":["socketCtr","that","respone_map","call_index","_socket","event","_sendmsg","cmdtype","req","callindex","emit","cmd","data","_request","callback","console","log","JSON","stringify","initSocket","opts","close","window","io","connect","defines","serverUrl","on","fire","res","hasOwnProperty","callBackIndex","result","type","request_wxLogin","request_creatroom","request_jion","request_reset","request_enter_room","request_re_room","request_buchu_card","request_chu_card","onPlayerJoinRoom","onPlayerReady","onGameStart","onChangeHouseManage","requestReady","onPlayerDisconnect","onPlayerDisonline","onPlayerReonline","onGameFinish","requestStart","requestRobState","state","onPushCards","onCanRobState","onRobState","onChangeMaster","onShowBottomCard","onCanChuCard","onRoomChangeState","onOtherPlayerChuCard","onSocketClosed"],"mappings":"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","sourceRoot":"/","sourcesContent":["import eventlister from \"../util/event_lister.js\"\n// import socketio from \"../lib/socket_io.js\"\nvar socketCtr = function(){\n    var that = {}\n    var respone_map = {} \n    var call_index = 0\n\n    that._socket = null\n    var event = eventlister({})\n     that._sendmsg = function(cmdtype,req,callindex){\n\t\n        that._socket.emit(\"notify\",{cmd:cmdtype,data:req,callindex:callindex})\n    } \n \n     that._request = function(cmdtype,req,callback){\n        console.log(\"send cmd:\"+cmdtype+\"  \"+ JSON.stringify(req))\n        call_index++ \n        respone_map[call_index] = callback\n        that._sendmsg(cmdtype,req,call_index)\n    } \n  \n        \n    that.initSocket = function(callback){\n        var opts = {\n            'reconnection':true,\n            'force new connection': true,\n            'transports':['websocket', 'polling']\n        }\n\t\tif(that._socket!=null){\n\t\t\tthat._socket.close();\n\t\t\tthat._socket=null;\n\t\t}\n        that._socket = window.io.connect(defines.serverUrl,opts);// new WebSocket(defines.serverUrl);// socketio(defines.serverUrl,opts);//  window.io.connect(defines.serverUrl,opts);\n\n        that._socket.on(\"connection\",function(){\n            console.log(\"connect server success!!\")\n\t\t\tif(callback){\n\t\t\t\tconsole.log(\"有回调\")\n\t\t\t\tcallback();\n\t\t\t}\n          })\n\t\tthat._socket.on(\"disconnect\",function(){\n\t\t\tconsole.log(\"disconnect from server!\")\n\t\t\t event.fire(\"socket_closed_notify\",{});\n\t\t})\n\t\t\n\n       that._socket.on(\"notify\",function(res){\n         console.log(\"on notify cmd:\" + JSON.stringify(res))\n         if(respone_map.hasOwnProperty(res.callBackIndex)){\n           var callback = respone_map[res.callBackIndex]\n           if(callback){\n               callback(res.result,res.data)\n           }\n          }else{\n           //if(res.callBackIndex!=0){\n           //console.log(\"not found call index\",res.callBackIndex)\n              \n               //提交一个监听的事件给监听器\n        //  on notify cmd:{\"type\":\"player_joinroom_notify\",\"result\":0,\"data\":\n        //  {\"accountid\":\"2586422\",\"nick_name\":\"tiny110\",\"avatarUrl\":\n        //  \"avatar_3\",\"goldcount\":1000,\"seatindex\":2},\"callBackIndex\":null}\n              //没有找到回到函数，就给事件监听器提交一个事件\n              var type = res.type\n              event.fire(type,res.data)\n          // }\n           \n         }\n\n        })\n\n    }\n\n    that.request_wxLogin = function(req,callback){\n        that._request(\"wxlogin\",req,callback)\n    }\n    \n    that.request_creatroom = function(req,callback){\n        that._request(\"createroom_req\",req,callback)\n    }\n\n    that.request_jion = function(req,callback){\n        that._request(\"joinroom_req\",req,callback)\n    }\n\tthat.request_reset = function(req,callback){\n\t    that._request(\"resetroom_req\",req,callback)\n\t}\n\n    that.request_enter_room = function(req,callback){\n       that._request(\"enterroom_req\",req,callback)\n    }\n\n     that.request_re_room = function(req,callback){\n         that._request(\"reroom_req\",req,callback)\n     }\n    //发送不出牌信息\n    that.request_buchu_card =  function(req,callback){\n        that._request(\"chu_bu_card_req\",req,callback)\n    }\n    /*玩家出牌\n      需要判断: \n         出的牌是否符合规则\n         和上个出牌玩家比较，是否满足条件\n\n    */\n    that.request_chu_card = function(req,callback){\n       that._request(\"chu_card_req\",req,callback)\n    }\n    //监听其他玩家进入房间消息\n    that.onPlayerJoinRoom = function(callback){\n         event.on(\"player_joinroom_notify\",callback)\n    }\n\n    that.onPlayerReady = function(callback){\n        event.on(\"player_ready_notify\",callback)\n    }\n\n    that.onGameStart = function(callback){\n        if(callback){\n           event.on(\"gameStart_notify\",callback)\n        }\n    }\n\n    that.onChangeHouseManage = function(callback){\n        if(callback){\n            event.on(\"changehousemanage_notify\",callback)\n        }\n    }\n    //发送ready消息\n    that.requestReady = function(){\n        that._sendmsg(\"player_ready_notify\",{},null)\n    }\n    //监听 disconnect 消息  玩家 离开房间\n\tthat.onPlayerDisconnect=function(callback){\n\t\tif(callback){\n\t\t\tevent.on(\"player_disconnect_notify\",callback);\n\t\t}\n\t}\n\t//监听 disonline 消息  玩家 游戏中掉线\n\tthat.onPlayerDisonline=function(callback){\n\t\tif(callback){\n\t\t\tevent.on(\"player_disonline_notify\",callback);\n\t\t}\n\t}\n\t//监听 reonline 消息  玩家 游戏中重新连线\n\tthat.onPlayerReonline=function(callback){\n\t\tif(callback){\n\t\t\tevent.on(\"player_reonline_notify\",callback);\n\t\t}\n\t}\n\tthat.onGameFinish=function(callback){\n\t\tif(callback){\n\t\t\tevent.on(\"gameFinish_notify\",callback);//监听服务端 返回消息\n\t\t}\n\t}\n\t\n \n    that.requestStart = function(callback){\n        that._request(\"player_start_notify\",{},callback)\n    }\n\n    //玩家通知服务器抢地主消息\n    that.requestRobState = function(state){\n        that._sendmsg(\"player_rob_notify\",state,null)\n    }\n    //服务器下发牌通知\n    that.onPushCards = function(callback){\n        if(callback){\n            event.on(\"pushcard_notify\",callback)\n         }\n    }\n\n    //监听服务器通知开始抢地主消息\n    that.onCanRobState = function(callback){\n        if(callback){\n            event.on(\"canrob_notify\",callback)\n         }\n    }\n\n    //监听服务器:通知谁抢地主操作消息\n    that.onRobState = function(callback){\n        if(callback){\n            event.on(\"canrob_state_notify\",callback)\n         }\n    }\n\n    //监听服务器:确定地主消息\n    that.onChangeMaster = function(callback){\n        if(callback){\n            event.on(\"change_master_notify\",callback)\n         }\n    }\n\n    //监听服务器:显示底牌消息\n    that.onShowBottomCard = function(callback){\n        if(callback){\n            event.on(\"change_showcard_notify\",callback)\n         }\n    }\n\n    //监听服务器:可以出牌消息\n    that.onCanChuCard = function(callback){\n        if(callback){\n            event.on(\"can_chu_card_notify\",callback)\n        }\n    }\n   \n    that.onRoomChangeState = function(callback){\n        if(callback){\n            event.on(\"room_state_notify\",callback)\n        }\n    }\n\n    that.onOtherPlayerChuCard = function(callback){\n        if(callback){\n            event.on(\"other_chucard_notify\",callback)\n        }\n    }\n\t\n\tthat.onSocketClosed=function(callback){\n\t\tif(callback){\n\t\t    event.on(\"socket_closed_notify\",callback)\n\t\t}\n\t}\n\t\n    return that\n}\n\nexport default socketCtr "]}