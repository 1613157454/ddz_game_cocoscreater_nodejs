{"version":3,"sources":["assets/scripts/gameScene/gameScene.js"],"names":["cc","Class","Component","properties","di_label","Label","beishu_label","roomid_label","player_node_prefabs","Prefab","players_seat_pos","Node","gameEnd","console","log","onLoad","playerNodeList","playerdata_list","string","myglobal","playerData","bottom","rate","roomstate","RoomState","ROOM_INVALID","node","on","i","length","emit","bind","socket","onRoomChangeState","data","getChildByName","getComponent","ResetUI_","onPlayerDisconnect","accountid","deletePlayerNode","onPlayerDisonline","offlinePlayerNode","onPlayerReonline","onlinePlayerNode","onSocketClosed","ROOM_GAMESTART","director","loadScene","returnroom","active","JSON","stringify","event","gameui_node","request_enter_room","err","result","seatid","seatindex","playerdata_list_pos","setPlayerSeatPos","playerdata","roomid","housemanageid","addPlayerNode","isopen_sound","audioEngine","stopAll","play","url","raw","gamebefore_node","onPlayerJoinRoom","join_playerdata","onPlayerReady","onGameStart","gamebeforeUI","onRobState","onChangeMaster","master_accountid","onShowBottomCard","seat_index","player_data","playernode_inst","instantiate","parent","index","position","children","init_data","push","p","_this","j","setTimeout","removeFromParent","destroy","splice","getPlayerNodeByAccountid","onOffLine","onOnLine","accountID","start","getUserOutCardPosByAccount","node_script","seat_node","index_name","out_card_node"],"mappings":"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","sourceRoot":"/","sourcesContent":["import myglobal from \"../mygolbal.js\"\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        di_label:cc.Label,\n        beishu_label:cc.Label,\n        roomid_label:cc.Label,\n        player_node_prefabs:cc.Prefab,\n        //绑定玩家座位,下面有3个子节点\n        players_seat_pos:cc.Node,\n        \n    },\n    //本局结束，做状态清除\n    gameEnd(){\n       console.log(\"本局结束,做 状态 清除\")\n    },\n    onLoad () {\n        this.playerNodeList = []\n\t\tthis.playerdata_list=[]\n        this.di_label.string = \"底:\" +  myglobal.playerData.bottom\n        this.beishu_label.string = \"倍数:\" + myglobal.playerData.rate\n        this.roomstate = RoomState.ROOM_INVALID\n        //监听，给其他玩家发牌(内部事件)\n        this.node.on(\"pushcard_other_event\",function(){\n            console.log(\"gamescene pushcard_other_event\")\n            for(var i=0;i<this.playerNodeList.length;i++){\n                    var node = this.playerNodeList[i]\n                    if(node){\n                    //给playernode节点发送事件\n                        node.emit(\"push_card_event\")\n                    }\n            }\n        }.bind(this))\n\n        //监听房间状态改变事件\n        myglobal.socket.onRoomChangeState(function(data){\n            //回调的函数参数是进入房间用户消息\n            console.log(\"onRoomChangeState:\"+data)\n            this.roomstate = data\n\t\t\tif(this.roomstate==RoomState.ROOM_INVALID){//\n\t\t\t//重置游戏\n\t\t\t\tconsole.log(\"重置 游戏\");\n\t\t\t\t//var gamebefore_node = this.node.getChildByName(\"gameingUI\")\n\t\t\t\tthis.node.getChildByName(\"gameingUI\").getComponent(\"gameingUI\").ResetUI_()\n\n\t\t\t\t//gamebefore_node.emit(\"init\")\n\t\t\t\t\n\t\t\t}\n        }.bind(this))\n\t\t\n\t\tmyglobal.socket.onPlayerDisconnect(function(data){\n\t\t\tconsole.log(\"onPlayerDisconnect 玩家离开房间:\"+data.accountid+\" \") //某个玩家离开房间\n\t\t\tthis.deletePlayerNode(data);\n\t\t}.bind(this));\n\t\tmyglobal.socket.onPlayerDisonline(function(data){\n\t\t\tconsole.log(\"onPlayerDisonline 玩家掉线:\"+data.accountid+\" \") //某个玩家 游戏中掉线\n\t\t\tthis.offlinePlayerNode(data);\n\t\t}.bind(this));\n\t\tmyglobal.socket.onPlayerReonline(function(data){\n\t\t\tconsole.log(\"onPlayerReonline 玩家重新连接成功:\"+data.accountid+\" \") //某个玩家 游戏中掉线重连成功通知\n\t\t\tthis.onlinePlayerNode(data);\n\t\t}.bind(this));\n\t\t\n\t  \n\t\t \n        //\n\t\tmyglobal.socket.onSocketClosed(function(data){\n\t\t\tconsole.log(\"onSocketClosed:\"+data)\n\t\t\t\n\t\t\t  if(this.roomstate< RoomState.ROOM_GAMESTART){\n\t\t\t\t  \n\t\t\t\t  cc.director.loadScene(\"hallScene\");\n\t\t\t\t  return;\n\t\t\t  }\n\t\t\t\n\t\tvar node=this.node.getChildByName(\"gameingUI\").getComponent(\"gameingUI\");\n\t\t\tnode.returnroom.active=true;\n\t\t\t\n\t\t\t\n\t\t}.bind(this));\n\t\t\n\t\n\t\t\n\t\t\n\t\tthis.node.on(\"onCanChuCard_gameScene\",function(data){\n\t\t\tconsole.log(\"等待玩家出牌 \",JSON.stringify(data));\n\t\t\t//通知 可以出牌\n\t\t\tfor(var i=0;i<this.playerNodeList.length;i++){\n\t\t\t    var node = this.playerNodeList[i]\n\t\t\t    if(node){\n\t\t\t\t\tnode.emit(\"onCanChuCard_playernode\",data);\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n        this.node.on(\"canrob_event\",function(event){\n            console.log(\"gamescene canrob_event:\"+event)\n            //通知给playernode子节点\n            for(var i=0;i<this.playerNodeList.length;i++){\n                var node = this.playerNodeList[i]\n                if(node){\n                    //给playernode节点发送事件\n                    node.emit(\"playernode_canrob_event\",event)\n                }\n            }\n        }.bind(this))\n\t\t\n\n        this.node.on(\"choose_card_event\",function(event){\n            console.log(\"--------choose_card_event-----------\")\n            var gameui_node =  this.node.getChildByName(\"gameingUI\")\n            if(gameui_node==null){\n               console.log(\"get childer name gameingUI\")\n               return\n            }\n            gameui_node.emit(\"choose_card_event\",event)\n           \n        }.bind(this))\n\n        this.node.on(\"unchoose_card_event\",function(event){\n            console.log(\"--------unchoose_card_event-----------\")\n            var gameui_node =  this.node.getChildByName(\"gameingUI\")\n            if(gameui_node==null){\n               console.log(\"get childer name gameingUI\")\n               return\n            }\n            gameui_node.emit(\"unchoose_card_event\",event)\n        }.bind(this))\n        //监听给玩家添加三张底牌\n        // this.node.on(\"add_three_card\",function(event){\n        //     console.log(\"add_three_card:\"+event)\n        //     for(var i=0;i<this.playerNodeList.length;i++){\n        //         var node = this.playerNodeList[i]\n        //         if(node){\n        //             //给playernode节点发送事件\n        //             node.emit(\"playernode_add_three_card\",event)\n        //         }\n        //     }\n        // }.bind(this))\n\n        myglobal.socket.request_enter_room({},function(err,result){\n            console.log(\"enter_room_resp\"+ JSON.stringify(result))\n            if(err!=0){\n               console.log(\"enter_room_resp err:\"+err)\n            }else{\n             \n              //enter_room成功\n              //notify ={\"seatid\":1,\"playerdata\":[{\"accountid\":\"2117836\",\"nick_name\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}]}\n                var seatid = result.seatindex //自己在房间里的seatid\n                this.playerdata_list_pos = []  //3个用户创建一个空用户列表\n                this.setPlayerSeatPos(seatid)\n\n                var playerdata_list = result.playerdata\n                var roomid = result.roomid\n\t\t\t\tthis.roomid=result.roomid\n                this.roomid_label.string = \"房间号:\" + roomid\n                myglobal.playerData.housemanageid = result.housemanageid\n                \n                for(var i=0;i<playerdata_list.length;i++){\n                    //consol.log(\"this----\"+this)\n                    this.addPlayerNode(playerdata_list[i])\n                }\n\n                if(isopen_sound){\n                    cc.audioEngine.stopAll()\n                    cc.audioEngine.play(cc.url.raw(\"resources/sound/bg.mp3\"),true) \n                 }\n            }\n            var gamebefore_node = this.node.getChildByName(\"gamebeforeUI\")\n            gamebefore_node.emit(\"init\")\n        }.bind(this))\n\n        //在进入房间后，注册其他玩家进入房间的事件\n        myglobal.socket.onPlayerJoinRoom(function(join_playerdata){\n            //回调的函数参数是进入房间用户消息\n            console.log(\"onPlayerJoinRoom:\"+JSON.stringify(join_playerdata))\n            this.addPlayerNode(join_playerdata)\n        }.bind(this))\n        \n        //回调参数是发送准备消息的accountid\n        myglobal.socket.onPlayerReady(function(data){\n            console.log(\"-------onPlayerReady:\"+data)\n            for(var i=0;i<this.playerNodeList.length;i++){\n                var node = this.playerNodeList[i]\n                if(node){\n                    node.emit(\"player_ready_notify\",data)\n                }\n            }\n        }.bind(this))\n\n        myglobal.socket.onGameStart(function(){\n            for(var i=0;i<this.playerNodeList.length;i++){\n                var node = this.playerNodeList[i]\n                if(node){\n                    node.emit(\"gamestart_event\")\n                }\n            }\n\n        //隐藏gamebeforeUI节点\n        var gamebeforeUI = this.node.getChildByName(\"gamebeforeUI\")\n            if(gamebeforeUI){\n                gamebeforeUI.active = false\n            }\n        }.bind(this))\n\n              //监听服务器玩家抢地主消息\n        myglobal.socket.onRobState(function(event){\n                console.log(\"-----onRobState\"+JSON.stringify(event))\n                //onRobState{\"accountid\":\"2162866\",\"state\":1}\n                for(var i=0;i<this.playerNodeList.length;i++){\n                    var node = this.playerNodeList[i]\n                    if(node){\n                        //给playernode节点发送事件\n                        node.emit(\"playernode_rob_state_event\",event)\n                    }\n                }\n        }.bind(this))\n\n        //注册监听服务器确定地主消息\n        myglobal.socket.onChangeMaster(function(event){\n            console.log(\"onChangeMaster\"+event)\n            //保存一下地主id\n            myglobal.playerData.master_accountid = event\n            for(var i=0;i<this.playerNodeList.length;i++){\n                var node = this.playerNodeList[i]\n                if(node){\n                    //给playernode节点发送事件\n                    node.emit(\"playernode_changemaster_event\",event)\n                }\n            }\n        }.bind(this))\n        \n        //注册监听服务器显示底牌消息\n        myglobal.socket.onShowBottomCard(function(event){\n           console.log(\"onShowBottomCard---------\"+event)\n           var gameui_node =  this.node.getChildByName(\"gameingUI\")\n           if(gameui_node==null){\n              console.log(\"get childer name gameingUI\")\n              return\n           }\n           gameui_node.emit(\"show_bottom_card_event\",event)\n        }.bind(this))\n    },\n\n    //seat_index自己在房间的位置id\n    setPlayerSeatPos(seat_index){\n        if(seat_index < 1 || seat_index > 3){\n            console.log(\"seat_index error\"+seat_index)\n            return\n        }\n\n        console.log(\"setPlayerSeatPos seat_index:\" + seat_index)\n       \n        //界面位置转化成逻辑位置\n        switch(seat_index){\n            case 1:\n                   this.playerdata_list_pos[1] = 0\n                   this.playerdata_list_pos[2] = 1 \n                   this.playerdata_list_pos[3] = 2\n              break\n             case 2:\n                   \n\n                    this.playerdata_list_pos[2] = 0\n                    this.playerdata_list_pos[1] = 1\n                    this.playerdata_list_pos[3] = 2\n                    break\n             case 3:\n                    this.playerdata_list_pos[3] = 0     \n                    this.playerdata_list_pos[2] = 1\n                    this.playerdata_list_pos[1] = 2\n                    break\n            default: \n              break      \n        } \n\n    },\n\n    addPlayerNode(player_data){\n        var playernode_inst = cc.instantiate(this.player_node_prefabs)\n        playernode_inst.parent = this.node\n      \n\n        //玩家在room里的位置索引(逻辑位置)\n        var index = this.playerdata_list_pos[player_data.seatindex]\n        console.log(\"index \"+player_data.seatindex+ \" \"+index)\n        playernode_inst.position = this.players_seat_pos.children[index].position\n        playernode_inst.getComponent(\"player_node\").init_data(player_data,index)\n\t\t//创建的节点存储在gamescene的列表中\n\t\tthis.playerNodeList.push(playernode_inst)\n    },\n\tdeletePlayerNode(p){//某个玩家 离开房间\n\t\t  const _this=this;\n\t      for(var i=0;i<_this.playerNodeList.length;i++){\n\t\t\t  console.log(\"is delete \"+_this.playerNodeList[i].getComponent(\"player_node\").accountid+\":\"+p.accountid);\n\t\t\t  if(_this.playerNodeList[i].getComponent(\"player_node\").accountid==p.accountid){\n\t\t\t\t  console.log(\"delete \"+i+\":\"+p.accountid);\n\t\t\t\t      var j=i;\n\t\t\t\t\t  setTimeout(function () {\n\t\t\t\t        _this.playerNodeList[j].removeFromParent();\n\t\t\t\t        _this.playerNodeList[j].destroy();\n\t\t\t\t        // delete(_this.playerNodeList[j]);\n\t\t\t\t\t\t_this.playerNodeList.splice(j,1);\n\t\t\t\t      }.bind(_this),100);\n\t\t\t\t  \n\t\t\t  }\n\t\t  }\n\t\t\n\t},\n\tgetPlayerNodeByAccountid(accountid){\n\t\tconst _this=this;\n\t\tfor(var i=0;i<_this.playerNodeList.length;i++){\n\t\t\t\t\t//  console.log(\"is delete \"+_this.playerNodeList[i].getComponent(\"player_node\").accountid+\":\"+accountid);\n\t\t    if(_this.playerNodeList[i].getComponent(\"player_node\").accountid==accountid){\n\t\t\t\treturn _this.playerNodeList[i];\n\t\t\t}\n\t\t}\n\t},\n\tofflinePlayerNode(p){//某个玩家 游戏中掉线\n\t\tconst _this=this;\n\t\t var node= _this.getPlayerNodeByAccountid(p.accountid);\n\t\t node.getComponent(\"player_node\").onOffLine();\n\t\t// for(var i=0;i<_this.playerdata_list.length;i++){\n\t\t//   if(_this.playerdata_list[i].accountid==p.accountid){\n\t\t// \t  _this.playerNodeList[i].getComponent(\"player_node\").onOffLine();\n\t\t//   }\n\t\t// }\n\t},\n\tonlinePlayerNode(p){//某个玩家 游戏中掉线重新连接成功\n\t\tconst _this=this;\n\t\t// for(var i=0;i<_this.playerdata_list.length;i++){//\n\t\t//   if(_this.playerdata_list[i].accountid==p.accountid){\n\t\t// \t  _this.playerNodeList[i].getComponent(\"player_node\").onOnLine();\n\t\t//   }\n\t\t// }\n\t\tvar node= _this.getPlayerNodeByAccountid(p.accountid);\n\t\tnode.getComponent(\"player_node\").onOnLine();\n\t\t\n\t\tif(p.accountid==myglobal.playerData.accountID){// 自己掉线重连成功\n\t\t  //获取 手牌 和 房间最新状态   \n\t\t  //手牌  房间状态  当前到谁出牌, 上次玩家 出牌是什么  出牌剩余时间  地主底牌是什么\n\t\t\tconsole.log(\"我重连成功了\");\t\n\t\t}\n\t\t\n\t},\n    start () {\n    },\n\n    /*\n     //通过accountid获取用户出牌放在gamescend的位置 \n     做法：先放3个节点在gameacene的场景中cardsoutzone(012)\n           \n    */\n    getUserOutCardPosByAccount(accountid){\n        console.log(\"getUserOutCardPosByAccount accountid:\"+accountid)\n        for(var i=0;i<this.playerNodeList.length;i++){\n            var node = this.playerNodeList[i]\n            if(node){\n                //获取节点绑定的组件\n                var node_script = node.getComponent(\"player_node\")\n                //如果accountid和player_node节点绑定的accountid相同\n                //接获取player_node的子节点\n                if(node_script.accountid===accountid){\n                  var seat_node = this.players_seat_pos.children[node_script.seat_index]\n                  var index_name = \"cardsoutzone\"+node_script.seat_index\n                  //console.log(\"getUserOutCardPosByAccount index_name:\"+index_name)\n                  var out_card_node = seat_node.getChildByName(index_name)\n                  //console.log(\"OutZone:\"+ out_card_node.name)\n                  return out_card_node\n                }\n            }\n        }\n\n        return null\n    },\n    // update (dt) {},\n});\n"]}